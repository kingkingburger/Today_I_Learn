## 도커에서 Container 포트와 host포트의 계념

Docker를 처음 접하는 사람이라면 응당 리눅스를 사용할 것이고, 포트에 대한 개념도 알고 있을 것이다. 그러나 Docker를 사용하다보면 헷갈리는 것이 있다. 바로 Run 커맨드에 주는 -p에 대한 것인데, 초보라면 개념을 잡고 넘어가는 것이 좋다.



```
docker run -p 80:5000 --name test centos:latest
```

위에서 보이는 커맨드는 docker run으로 test라는 이름을 가진 컨테이너를 centos:latest 이미지를 통해서 생성한다는 뜻이다. 그렇다면 

-p 옵션은 무슨 뜻일까?



```
-p 80:5000
```

에서 80, 5000은 둘 다 의미가 있다. 앞의 80은 도커를 설치한 호스트의 80포트를, 컨테이너의 5000번 포트에 연결한다는 뜻이다.





컨테이너의 5000번 포트라니, 이게 무슨 뜻인지 모를 수도 있으니 설명하고 넘어가도록 하자.



컨테이너도 일반 머신과 동일하게 포트를 0번부터 65535번까지 가지고 있다(아마도). 정말로 0번부터 65535번까지인지는 모르겠지만, 어쨌든 포트를 가지고 있다. 

​     ![img](https://postfiles.pstatic.net/20150221_41/alice_k106_1424488786398ULbfz_PNG/%C4%B8%C3%B3.PNG?type=w2)

즉, 호스트이 80포트와 컨테이너의 5000번 포트를 연결한다는 것은 외부에서 호스트의 80번 포트로 접속한다면 그 80번 포트는 컨테이너의 5000번 포트에 연결되어 있기 때문에 컨테이너의 5000번 포트로 연결이 된다. 즉



외부에서 서버 80포트로 접근 -> 80포트는 컨테이너의 5000번 포트에 연결되어있다 -> 외부에서 80번 포트에 접속한다 = 컨테이너의 5000번 포트에 접속한다



라는 의미가 된다.

​             ![img](https://postfiles.pstatic.net/20150221_131/alice_k106_14244891403328IKAO_PNG/%C4%B8%C3%B3.PNG?type=w2) 

이것이 무엇이 중요한가? 라고 말한다면, 사실 대부분의 경우에는 상관이 없다. 이미 사용이 정해진 포트 외에는 어느 포트를 고르든지 상관이 없다(컨테이너의 경우). 호스트의 포트의 경우에는 그냥 개방이 되어있고, 중복되지 않게만 사용하면 된다. 컨테이너의 포트도 정말로 어느 포트를 고르든지 상관이 없다. 겹치지만 않으면 된다(중복 포트 연결 및 개방이 가능하기 때문이다). 사실 중요한 경우는 따로 있다.





**MYSQL 컨테이너**의 경우를 생각해보자. mysql에 접속할때에는 무조건 3306으로 접속해야하며 이것은 정해진 포트라는 것을 우리는 알고 있다. 3306포트를 쓴다는 점이 매우매우 중요하다.



```
docker run -e MYSQL_ROOT_PASSWORD=1 -p 80:5000 --name test.mysql mysql:latest
```

위와 같이 컨테이너를 생성한다면, root 비밀번호는 1이고 호스트의 80번 포트로 접속하면 컨테이너의 5000번 포트로 연결이 될 것이고, 이름은 test.mysql, 이미지는 mysql을 쓰니 mysql 컨테이너가 생성이 될 것이다. 위처럼 컨테이너를 생성한 뒤, 80번 포트로 접속을 하면 mysql을 사용할 수 없다. 왜냐하면 mysql은 3306을 사용하기 때문이다.



​    ![img](https://postfiles.pstatic.net/20150221_20/alice_k106_1424489604526RuoMi_PNG/%C4%B8%C3%B3.PNG?type=w2) 

mysql은 컨테이너의 3306포트에 연결되어 있는데, 호스트의 80번 포트는 컨테이너의 5000번 포트에 연결되어 있으니, 외부에서 컨테이너의 mysql에 접속하려고 해도 할 수가 없다. 왜냐하면 컨테이너 안에서 구동중인 mysql은 3306 컨테이너 포트를 쓰고 있는데, 호스트의 80포트는 3306포트에 연결되어 있지 않기 때문이다. 즉, 외부에서 호스트의 포트를 타고 컨테이너의 mysql에 접근하려면 다음과 같이 입력해야 한다. 



```
docker run -e MYSQL_ROOT_PASSWORD=1 -p 80:3306 --name test.mysql mysql:latest
```

위와 같이 입력하면 80번 포트가 컨테이너의 3306 포트로 연결되어 외부에서 connect mysql같은 함수로 80번 포트로 접근한다면 컨테이너 mysql에 접속할 수 있다.



​    ![img](https://postfiles.pstatic.net/20150221_36/alice_k106_1424489981009daMoo_PNG/%C4%B8%C3%B3.PNG?type=w2)





이와 같이, 컨테이너 포트는 특정 상황에서 중요하다. 특정 어플리케이션이 특정 포트만을 사용하도록 설정되어 있다면, 그 컨테이너 포트에 호스트 포트를 연결해줘야만 외부에서 접속할 수 있다.

#### 출처

https://blog.naver.com/PostView.nhn?isHttpsRedirect=true&blogId=alice_k106&logNo=220278762795